<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clanker Conk Control Room</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="backdrop"></div>
    <main class="shell">
      <header class="hero panel">
        <p class="eyebrow">Discord Persona Ops</p>
        <h1>clanker conk control room</h1>
        <p class="sub">Tune behavior, monitor spend, and track every message/reaction.</p>
        <div class="token-row">
          <label for="dashboard-token">Dashboard token</label>
          <input id="dashboard-token" type="password" placeholder="optional" />
          <button id="save-token" type="button">Save token</button>
        </div>
      </header>

      <section class="metrics">
        <article class="metric panel">
          <p>Runtime</p>
          <h2 id="runtime-state">-</h2>
        </article>
        <article class="metric panel">
          <p>Total API Cost</p>
          <h2 id="total-cost">$0.000000</h2>
        </article>
        <article class="metric panel">
          <p>Replies (24h)</p>
          <h2 id="reply-count">0</h2>
        </article>
        <article class="metric panel">
          <p>Drop-ins (24h)</p>
          <h2 id="message-count">0</h2>
        </article>
        <article class="metric panel">
          <p>Reactions (24h)</p>
          <h2 id="reaction-count">0</h2>
        </article>
      </section>

      <section class="grid">
        <form id="settings-form" class="panel">
          <h3>Behavior Settings</h3>

          <label for="bot-name">Bot display name</label>
          <input id="bot-name" type="text" />

          <label for="reply-level">Unsolicited reply chance: <span id="reply-value">35</span>%</label>
          <input id="reply-level" type="range" min="0" max="100" step="1" />

          <label for="reaction-level">Reaction eagerness: <span id="reaction-value">20</span>%</label>
          <input id="reaction-level" type="range" min="0" max="100" step="1" />

          <div class="toggles">
            <label><input id="allow-replies" type="checkbox" /> Allow replies</label>
            <label><input id="allow-initiative" type="checkbox" /> Allow initiative replies</label>
            <label><input id="allow-reactions" type="checkbox" /> Allow reactions</label>
            <label><input id="memory-enabled" type="checkbox" /> Memory enabled</label>
          </div>

          <label for="provider">LLM provider</label>
          <select id="provider">
            <option value="openai">openai</option>
            <option value="anthropic">anthropic</option>
          </select>

          <label for="model">Model</label>
          <input id="model" type="text" placeholder="gpt-4.1-mini / claude-3-5-haiku-latest" />

          <div class="split">
            <div>
              <label for="temperature">Temperature</label>
              <input id="temperature" type="number" min="0" max="2" step="0.1" />
            </div>
            <div>
              <label for="max-tokens">Max output tokens</label>
              <input id="max-tokens" type="number" min="32" max="1400" step="1" />
            </div>
          </div>

          <div class="split">
            <div>
              <label for="max-messages">Max bot messages/hour</label>
              <input id="max-messages" type="number" min="1" max="200" />
            </div>
          </div>

          <div class="split">
            <div>
              <label for="max-reactions">Max reactions/hour</label>
              <input id="max-reactions" type="number" min="1" max="300" />
            </div>
            <div>
              <label for="min-gap">Min seconds between bot msgs</label>
              <input id="min-gap" type="number" min="5" max="300" />
            </div>
          </div>

          <h4>Startup Catch-up</h4>
          <div class="toggles">
            <label><input id="catchup-enabled" type="checkbox" /> Catch up on recent messages at startup</label>
          </div>
          <div class="split">
            <div>
              <label for="catchup-lookback">Catch-up lookback (hours)</label>
              <input id="catchup-lookback" type="number" min="1" max="24" />
            </div>
            <div>
              <label for="catchup-max-messages">Messages scanned per channel</label>
              <input id="catchup-max-messages" type="number" min="5" max="80" />
            </div>
          </div>
          <div class="split">
            <div>
              <label for="catchup-max-replies">Max startup replies per channel</label>
              <input id="catchup-max-replies" type="number" min="1" max="12" />
            </div>
          </div>

          <h4>Autonomous Initiative Posts</h4>
          <div class="toggles">
            <label><input id="initiative-enabled" type="checkbox" /> Enable autonomous posting</label>
            <label><input id="initiative-startup-post" type="checkbox" /> Post on startup when due</label>
            <label><input id="initiative-image-enabled" type="checkbox" /> Allow image posts</label>
          </div>
          <div class="split">
            <div>
              <label for="initiative-posts-per-day">Max initiative posts/day</label>
              <input id="initiative-posts-per-day" type="number" min="0" max="100" />
            </div>
            <div>
              <label for="initiative-min-minutes">Min minutes between initiative posts</label>
              <input id="initiative-min-minutes" type="number" min="5" max="1440" />
            </div>
          </div>
          <div class="split">
            <div>
              <label for="initiative-image-chance">Image post chance (%)</label>
              <input id="initiative-image-chance" type="number" min="0" max="100" />
            </div>
            <div>
              <label for="initiative-image-model">Image model</label>
              <input id="initiative-image-model" type="text" placeholder="gpt-image-1" />
            </div>
          </div>

          <label for="initiative-channels">Standalone post channel IDs (only these)</label>
          <textarea id="initiative-channels" rows="2"></textarea>

          <label for="allowed-channels">Allowed channel IDs (comma/newline)</label>
          <textarea id="allowed-channels" rows="3"></textarea>

          <label for="blocked-channels">Blocked channel IDs (comma/newline)</label>
          <textarea id="blocked-channels" rows="3"></textarea>

          <label for="blocked-users">Blocked user IDs (comma/newline)</label>
          <textarea id="blocked-users" rows="3"></textarea>

          <button type="submit" class="cta">Save settings</button>
          <p id="save-status" class="status"></p>
        </form>

        <section class="panel">
          <div class="panel-head">
            <h3>Action Stream</h3>
            <select id="action-filter">
              <option value="all">all</option>
              <option value="sent_reply">sent_reply</option>
              <option value="sent_message">sent_message</option>
              <option value="initiative_post">initiative_post</option>
              <option value="reacted">reacted</option>
              <option value="llm_call">llm_call</option>
              <option value="image_call">image_call</option>
            </select>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Kind</th>
                  <th>Channel</th>
                  <th>Content</th>
                  <th>Cost</th>
                </tr>
              </thead>
              <tbody id="actions-body"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section class="grid secondary">
        <section class="panel">
          <div class="panel-head">
            <h3>Memory</h3>
            <button id="refresh-memory" type="button">Refresh memory.md</button>
          </div>
          <pre id="memory-box" class="memory-box"></pre>
        </section>

        <section class="panel">
          <h3>Daily Cost (14d)</h3>
          <ul id="daily-cost" class="cost-list"></ul>
        </section>
      </section>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>
