sequenceDiagram
    autonumber
    participant Speaker as Voice Participant
    participant Voice as VoiceSessionManager
    participant Decider as evaluateVoiceReplyDecision
    participant DecideLLM as voice.replyDecisionLlm
    participant GenLLM as voice generation LLM
    participant Playback as Voice Playback/Realtime Client
    participant Store as Store

    Speaker->>Voice: audio turn captured
    Voice->>Voice: transcribe turn
    Voice->>Decider: Stage A admission
    alt heuristics unresolved
      Decider->>DecideLLM: YES/NO classifier call
      DecideLLM-->>Decider: decision contract
    end
    Decider-->>Voice: allow/deny + reason
    Voice->>Store: log voice_turn_addressing

    alt denied
      alt reason is bot_turn_open or awaiting_non_direct_silence_window
        Voice->>Voice: queueDeferredBotTurnOpenTurn(...)
      else hard deny
        Voice-->>Voice: stop turn
      end
    else allowed
      alt stt_pipeline or realtime brain
        Voice->>GenLLM: generateVoiceTurn(...) [Stage B]
        alt [SKIP]/empty/no playable output
          Voice->>Store: log stt_pipeline_reply_skipped or realtime_reply_skipped
        else playable output
          Voice->>Playback: playVoiceReplyInOrder(...)
          Voice->>Store: log stt_pipeline_reply_spoken or realtime_reply_requested
        end
      else realtime native strategy
        Voice->>Playback: appendInputAudioPcm + schedule response
        Note over Voice,Playback: Stage A gate only, no local [SKIP] step
      end
    end
